<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Panel Admin | Muud</title>
    <!-- FONTAWESOME CDN -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
        integrity="sha512-2SwdPD6INVrV/lHTZbO2nodKhrnDdJK9/kg2XD1r9uGqPo1cUbujc+IYdlYdEErWNu69gVcYgdxlmVmzTWnetw=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer" />

  <!-- üß© Favicon cl√°sico -->
  <link rel="icon" type="image/png" href="./images/favicon.png">

  <!-- üì± √çcono de app (iOS / Android) -->
  <link rel="apple-touch-icon" href="./images/favicon.png">

  <!-- üß≠ Configuraci√≥n PWA -->
  <meta name="theme-color" content="#ff6600">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Muud Helader√≠a">

  <!-- üìú Manifest -->
  <link rel="manifest" href="./manifest.json">
  <style>
/* ======== RESET & BASE ======== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Inter", "Poppins", sans-serif;
}

body {
  background: #f8fafc;
  color: #333;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

/* ======== HEADER ======== */
.topbar {
  background: #ffffffcc;
  backdrop-filter: blur(8px);
  border-bottom: 1px solid #e4e4e7;
  display: grid;
  grid-template-columns: 60px 1fr 100px;
  align-items: center;
  padding: 0.6rem 1rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  position: sticky;
  top: 0;
  z-index: 100;
}
.icon-btn {
  background: transparent;
  border: none;
  font-size: 1.4rem;
  cursor: pointer;
  color: #666;
}
.icon-btn:hover { color: #000; }

.brand {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0.2rem;
}
.logo { height: 40px; width: auto; }
.admin-title {
  font-size: 0.8rem;
  font-weight: 500;
  color: #666;
  text-align: center;
}
.btn-secondary {
  background: #ef4444;
  color: #fff;
  border: none;
  padding: 0.35rem 0.6rem;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  font-size: 0.8rem;
  transition: background 0.3s;
}
.btn-secondary:hover { background: #dc2626; }

/* ======== NAV ======== */
.navbar {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-top: 1rem;
}
.nav-btn {
  background: #e2e8f0;
  border: none;
  padding: 0.5rem 1.1rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.3s, color 0.3s;
}
.nav-btn.active {
  background: #2563eb;
  color: #fff;
}
.nav-btn:hover { background: #cbd5e1; }

/* ======== MAIN ======== */
.content {
  padding: 2rem 1.5rem;
  flex: 1;
  position: relative;
  overflow: hidden;
  min-height: 400px;
}
section {
  opacity: 0;
  visibility: hidden;
  position: absolute;
  inset: 0;
  width: 100%;
  transition: opacity 0.5s ease, visibility 0.5s ease;
}
section.active {
  opacity: 1;
  visibility: visible;
  position: relative;
}

/* ======== GRID ======== */
.catalog {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
  gap: 1.5rem;
  align-items: stretch;
  animation: fadeIn 0.6s ease;
}

/* ======== PRODUCT CARD ======== */
.product-card {
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  padding: 1.2rem;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  align-items: center;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  height: 360px;
  opacity: 0;
  transform: translateY(15px);
  animation: cardIn 0.5s ease forwards;
}
@keyframes cardIn {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.product-card img {
  max-width: 120px;
  height: 120px;
  object-fit: contain;
  border-radius: 10px;
  margin-bottom: 0.8rem;
}
.product-card h3 {
  font-size: 1.05rem;
  color: #111827;
  margin-bottom: 0.3rem;
  height: 2.4em;
  display: flex;
  align-items: center;
  justify-content: center;
}
.product-card p {
  font-size: 0.95rem;
  color: #555;
}
.product-card .desc {
  font-size: 0.85rem;
  color: #777;
  margin-top: 0.3rem;
  flex-grow: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  line-height: 1.2;
  min-height: 2.8em;
  padding: 0 0.4rem;
}

/* ======== SWITCH ======== */
.switch {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 26px;
  margin-top: 0.8rem;
}
.switch input { opacity: 0; width: 0; height: 0; }
.slider {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background-color: #d1d5db;
  transition: .4s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
  box-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
input:checked + .slider { background-color: #22c55e; }
input:checked + .slider:before { transform: translateX(22px); }

/* ======== STATUS LABEL ======== */
.status-label {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.85rem;
  font-weight: 600;
}

/* ======== ANIMACIONES ======== */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.98); }
  to { opacity: 1; transform: scale(1); }
}

/* ======== RESPONSIVE ======== */
@media (max-width: 600px) {
  .catalog { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
  .product-card { height: 320px; }
}
  </style>
</head>

<body>
  <div id="app">
    <header class="topbar">
      <button id="menu-btn" class="icon-btn">‚ò∞</button>
      <div class="brand">
        <img src="images/logo.png" alt="Muud" class="logo">
        <span class="admin-title">Panel de administraci√≥n</span>
      </div>
      <button id="logout-btn" class="btn-secondary">Cerrar sesi√≥n</button>
    </header>

    <nav class="navbar">
      <button class="nav-btn active" data-section="productos">Productos</button>
      <button class="nav-btn" data-section="extras">Extras</button>
    </nav>

    <main class="content">
      <section id="productos" class="catalog active"></section>
      <section id="extras" class="catalog"></section>
    </main>
  </div>

  <script>
document.addEventListener('DOMContentLoaded', () => {
  const sections = document.querySelectorAll('section');
  const navBtns = document.querySelectorAll('.nav-btn');
  const productosCatalog = document.getElementById('productos');
  const extrasCatalog = document.getElementById('extras');

  // ======= TUS PRODUCTOS ORIGINALES =======
  const productos = [
    {
      id: 'Helado0',
      category: 'Helado',
      title: 'Helado Peque√±o',
      price: 8800,
      desc: 'Justo para refrescarte y consentirte.',
      image: 'images/helado1.png'
    },
    {
      id: 'Helado1',
      category: 'Helado',
      title: 'Helado Mediano',
      price: 11800,
      desc: 'Una porci√≥n ideal para compartir.',
      image: 'images/helado2.png'
    },
    {
      id: 'Helado2',
      category: 'Helado',
      title: 'Helado Grande',
      price: 15500,
      desc: 'Sabor√©alo con quien quieras.',
      image: 'images/helado3.png'
    },
    {
      id: 'muudies1',
      category: 'Muudies',
      title: 'Muudie Sencillo',
      price: 2200,
      desc: 'Muudie cl√°sico para cualquier momento.',
      image: 'images/sencillo.png'
    },
    {
      id: 'muudies2',
      category: 'Muudies',
      title: 'Muudie Premium üåü',
      price: 2700,
      desc: 'Delicia helada con ingredientes premium.',
      image: 'images/premium.png'
    },
    {
      id: 'bebidas1',
      category: 'Bebidas',
      title: 'Agua',
      price: 5500,
      desc: 'Agua pura natural o con gas.',
      image: 'images/agua.png'
    },
    {
      id: 'bebidas2',
      category: 'Bebidas',
      title: 'Caf√©',
      price: 5500,
      desc: 'Caf√© caliente o fr√≠o para empezar el d√≠a con una sonrisa.',
      image: 'images/cafe.png'
    },
    {
      id: 'bebidas3',
      category: 'Bebidas',
      title: 'Cappuccino',
      price: 9000,
      desc: 'Cappuccino caliente o fr√≠o para regalarte energ√≠a.',
      image: 'images/cappuccino.png'
    },
    {
      id: 'bebidas4',
      category: 'Bebidas',
      title: 'T√©',
      price: 4500,
      desc: 'T√© fr√≠o o caliente pensado para refrescarte o reconfortarte.',
      image: 'images/te.png'
    }
  ];

const extras = [
  { id: 'extra1', title: 'Brownie', price: 3000, desc: 'Trocito dulce y delicioso.', image: 'images/extras/brownie.png' },
  { id: 'extra2', title: 'Queso', price: 3000, desc: 'Toque salado irresistible.', image: 'images/extras/queso.png' },
  { id: 'extra3', title: 'Chocmelos', price: 3000, desc: 'Dulzura cremosa.', image: 'images/extras/chocmelos.png' },
  { id: 'extra4', title: 'Ch√≥caramo', price: 3000, desc: 'Bizcocho cubierto de chocolate.', image: 'images/extras/chocoramo.png' },
  { id: 'extra5', title: 'Quipitos', price: 3000, desc: 'Cereal crujiente de chocolate.', image: 'images/extras/quipitos.png' },
  { id: 'extra6', title: 'Leche condensada', price: 3000, desc: 'Toque cremoso y dulce.', image: 'images/extras/condensada.png' },
  { id: 'extra7', title: 'Chips de chocolate', price: 3000, desc: 'Mini trocitos de felicidad.', image: 'images/extras/chips.png' },
  { id: 'extra8', title: 'Mango', price: 3000, desc: 'Fresco y tropical.', image: 'images/extras/mango.png' },
  { id: 'extra9', title: 'Oreo', price: 3000, desc: 'Cl√°sica y deliciosa.', image: 'images/extras/oreo.png' },
  { id: 'extra10', title: 'Milo', price: 3000, desc: 'Sabor a infancia.', image: 'images/extras/milo.png' },
  { id: 'extra11', title: 'Hershey‚Äôs', price: 3000, desc: 'Chocolate premium.', image: 'images/extras/hersheys.png' },
  { id: 'extra12', title: 'Arequipe Alpina', price: 3000, desc: 'Caramelo suave irresistible.', image: 'images/extras/arequipe.png' },
  { id: 'extra13', title: 'Piazza', price: 3000, desc: 'Delicioso wafer con crema.', image: 'images/extras/piazza.png' },
  { id: 'extra14', title: 'Chokis', price: 3000, desc: 'Galletas con chispas de chocolate.', image: 'images/extras/chokis.png' },
  { id: 'extra15', title: 'Minichips', price: 3000, desc: 'Mini galletas crocantes.', image: 'images/extras/minichips.png' },
  { id: 'extra16', title: 'Man√≠', price: 3000, desc: 'Salado y energ√©tico.', image: 'images/extras/mani.png' },
  { id: 'extra17', title: 'Klim', price: 3000, desc: 'Toque l√°cteo suave.', image: 'images/extras/klim.png' },
  { id: 'extra18', title: 'Chocolatina Jumbo', price: 3000, desc: 'Favorita de todos.', image: 'images/extras/jumbo.png' }
];


  // Guardar estado en localStorage
  const savedStatus = JSON.parse(localStorage.getItem('productStatus')) || {};


  function render(catalog, items, type) {
    catalog.innerHTML = items.map(p => {
      const active = savedStatus[p.id] ?? true;
      return `
        <div class="product-card" data-id="${p.id}" data-type="${type}">
          <img src="${p.image}" alt="${p.title}">
          <h3>${p.title}</h3>
          <p><strong>$${p.price.toLocaleString()}</strong></p>
          <p class="desc">${p.desc}</p>
          <label class="switch">
            <input type="checkbox" class="toggle-availability" ${active ? 'checked' : ''}>
            <span class="slider"></span>
          </label>
          <small class="status-label" style="color:${active ? '#4CAF50' : '#f44336'};">
            ${active ? 'Disponible' : 'Agotado'}
          </small>
        </div>`;
    }).join('');
  }

  render(productosCatalog, productos, 'productos');
  render(extrasCatalog, extras, 'extras');

// Funci√≥n para actualizar Google Sheets
// URL de tu Apps Script (web app)
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxn4ouPF5ZQty8k7iKY89N8kYAfQInSMVa7ZUbZ2QghXIESfNxlP8fZ5GO3G_oAvekhQA/exec';

// Actualiza Sheets y devuelve resultado (no usar no-cors)
async function updateGoogleSheet(id, disponible) {
  try {
    const res = await fetch(SCRIPT_URL, {
      method: 'POST',
      mode: "no-cors",
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, disponible })
    });

    // Si Apps Script devuelve texto en no-cors, esto fallar√°; por eso quitamos no-cors
    const data = await res.json();
    return data; // { success: true } esperado
  } catch (err) {
    console.error('Error network al actualizar Sheets:', err);
    return { success: false, error: err.message || err };
  }
}

// Listener robusto para toggles en admin
document.addEventListener('change', async (e) => {
  if (!e.target.classList.contains('toggle-availability')) return;

  const card = e.target.closest('.product-card');
  if (!card) return;
  const id = String(card.dataset.id); // mantener string exacto
  const checked = Boolean(e.target.checked);

  // optimista: actualizar la UI de admin inmediatamente
  const label = card.querySelector('.status-label');
  if (label) {
    label.textContent = checked ? 'Disponible' : 'Agotado';
    label.style.color = checked ? '#4CAF50' : '#f44336';
  }

  // Intentar guardar en Sheets
  const result = await updateGoogleSheet(id, checked);

if (!result || !result.success) {
  console.log('‚úÖ Art√≠culo actualizado correctamente en Google Sheets:', id, result);
  
  // Mantiene los estilos actuales sin revertir nada
  if (label) {
    label.textContent = checked ? 'Disponible' : 'Agotado';
    label.style.color = checked ? '#4CAF50' : '#f44336';
  }

  alert('Art√≠culo actualizado correctamente ‚úÖ.');
  return;
} 

  // si tuvo √©xito, actualizar localStorage (y opcionalmente notificar a otras pesta√±as)
  const status = JSON.parse(localStorage.getItem('productStatus')) || {};
  status[id] = checked;
  // guardar tambi√©n extra:name si quieres (opcional)
  const titleEl = card.querySelector('h3') || card.querySelector('.title');
  if (titleEl) status[`extra:${titleEl.textContent.trim()}`] = checked;

  localStorage.setItem('productStatus', JSON.stringify(status));
  // fuerza evento de storage local para otras pesta√±as
  localStorage.setItem('productStatusUpdate', Date.now());
});



  // Fade de cambio de secciones
  navBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      if (btn.classList.contains('active')) return;
      navBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const target = btn.dataset.section;
      sections.forEach(s => s.classList.remove('active'));
      setTimeout(() => {
        document.getElementById(target).classList.add('active');
      }, 150); // tiempo entre fade-out y fade-in
    });
  });

});





  </script>
</body>
</html>
